// Generated by CoffeeScript 1.9.1
(function() {
  var startSuggestion, substringMatcher, suggestionTemplate, ta;

  substringMatcher = function(strs) {
    return function(q, cb) {
      var matches, substrRegex;
      matches = void 0;
      substrRegex = void 0;
      matches = [];
      substrRegex = new RegExp(q, 'i');
      $.each(strs, function(i, str) {
        if (substrRegex.test(str.gov_name)) {
          matches.push(str);
          if (matches.length >= 14) {
            return false;
          }
        }
      });
      cb(matches);
    };
  };

  suggestionTemplate = Handlebars.compile('<p><span class="minwidth">{{gov_name}}</span> <span class="smaller">{{state}} &nbsp;{{zip}}</span></p>');

  ta = void 0;

  startSuggestion = function() {
    var link, makeFieldHtml, makeRecordHtml;
    link = function(v) {
      if (('' + v).indexOf('http://') === -1) {
        return v;
      } else {
        return '<a target="_blank" href="' + v + '">' + v + '</a>';
      }
    };
    makeFieldHtml = function(n, v) {
      var s;
      s = '';
      if (v) {
        s = "<p><span class='f-nam'>" + fieldNames[n] + "</span><span class='f-val'>" + (link(v)) + "</span></p>";
      }
      return s;
    };
    makeRecordHtml = function(data) {
      var n, s;
      s = '';
      for (n in data) {
        s += makeFieldHtml(n, data[n]);
      }
      $('#details').html(s);
    };
    $('.typeahead').attr('placeholder', 'GOVERNMENT NAME');
    ta = $('.typeahead').typeahead({
      hint: true,
      highlight: true,
      minLength: 1
    }, {
      name: 'gov_name',
      displayKey: 'gov_name',
      source: substringMatcher(govs),
      templates: {
        suggestion: suggestionTemplate
      }
    });
    ta.on('typeahead:selected', function(evt, data, name) {
      makeRecordHtml(data);
    });
  };

  $.ajax({
    url: 'js/fieldnames.js',
    dataType: 'script',
    cache: true,
    success: function() {
      console.log('field names loaded');
    }
  });

  $.ajax({
    url: 'data/govs.js',
    dataType: 'script',
    cache: true,
    success: startSuggestion
  });

}).call(this);

//# sourceMappingURL=b.js.map
